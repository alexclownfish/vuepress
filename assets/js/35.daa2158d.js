(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{559:function(a,e,s){"use strict";s.r(e);var t=s(8),r=Object(t.a)({},(function(){var a=this,e=a.$createElement,s=a._self._c||e;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h2",{attrs:{id:"准备工作"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#准备工作"}},[a._v("#")]),a._v(" 准备工作")]),a._v(" "),s("ul",[s("li",[a._v("下载源码包，下面会用到agent")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("https://archive.apache.org/dist/skywalking/6.6.0/apache-skywalking-apm-6.6.0.tar.gz\n")])])]),s("ul",[s("li",[a._v("拉取镜像")])]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("docker pull elasticsearch:7.5.1\ndocker pull apache/skywalking-oap-server:6.6.0-es7\ndocker pull apache/skywalking-ui:6.6.0\n")])])]),s("h2",{attrs:{id:"安装elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装elasticsearch"}},[a._v("#")]),a._v(" 安装elasticsearch")]),a._v(" "),s("h3",{attrs:{id:"修改系统参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改系统参数"}},[a._v("#")]),a._v(" 修改系统参数")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("vi /etc/sysctl.conf\n\nvm.max_map_count=262144 #调整参数\n\nsysctl -p #刷新参数\n")])])]),s("h3",{attrs:{id:"启动elasticsearch"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动elasticsearch"}},[a._v("#")]),a._v(" 启动elasticsearch")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v('docker run -d --name=es7 \\\n-p 9200:9200 -p 9300:9300 \\\n-e "discovery.type=single-node" elasticsearch:7.5.1\n')])])]),s("h4",{attrs:{id:"创建持久化目录-并拷贝数据"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建持久化目录-并拷贝数据"}},[a._v("#")]),a._v(" 创建持久化目录 并拷贝数据")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("mkdir -p /data/elasticsearch\ndocker cp es7:/usr/share/elasticsearch/data /data/elasticsearch/\ndocker cp es7:/usr/share/elasticsearch/logs /data/elasticsearch/\ndocker rm -f es7\n")])])]),s("h3",{attrs:{id:"docker-compose编排部署es-skywalking"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#docker-compose编排部署es-skywalking"}},[a._v("#")]),a._v(" docker-compose编排部署es，skywalking")]),a._v(" "),s("h4",{attrs:{id:"创建编排文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#创建编排文件"}},[a._v("#")]),a._v(" 创建编排文件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd /data && touch docker-compose.yml\ntar -zxvf apache-skywalking-apm-6.6.0.tar.gz  #解压源码以便后续使用agent\n")])])]),s("h4",{attrs:{id:"编辑编排文件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#编辑编排文件"}},[a._v("#")]),a._v(" 编辑编排文件")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("version: '3'\nnetworks:\n  cq-data-security:  ##我这里选择了已有网卡，与我java项目网卡一致可以容器之间相互通信，具体需求看自己\n    external: true\nservices:\n  es7:\n    image: elasticsearch:7.5.1\n    container_name: es7\n    expose:\n      - 9200\n      - 9300\n    restart: always\n    volumes:\n      - /data/elasticsearch/data:/usr/share/elasticsearch/data\n      - /data/elasticsearch/logs:/usr/share/elasticsearch/logs\n    environment:\n      - TZ=Asia/Shanghai\n      - LANG=en_US.UTF-8\n      - discovery.type=single-node\n    networks:\n      cq-data-security:\n        ipv4_address: 172.62.0.51\n\n  skywalking-oap-server:\n    image: apache/skywalking-oap-server:6.6.0-es7\n    container_name: skywalking-oap-server\n    expose:\n      - 12800\n      - 11800\n    privileged: true\n    restart: always\n    environment:\n      - TZ=Asia/Shanghai\n      - LANG=en_US.UTF-8\n      - SW_STORAGE=elasticsearch\n      - SW_STORAGE_ES_CLUSTER_NODES=172.62.0.51:9200\n    networks:\n      cq-data-security:\n        ipv4_address: 172.62.0.52\n\n  skywalking-ui:\n    image: apache/skywalking-ui:6.6.0\n    container_name: skywalking-ui\n    ports:\n      - 28080:8080\n    privileged: true\n    restart: always\n    environment:\n      - SW_OAP_ADDRESS=172.62.0.52:12800\n    networks:\n      cq-data-security:\n        ipv4_address: 172.62.0.53\n")])])]),s("p",[a._v("docker-compose up -d 直接启动即可\n访问localhost:28080  ui访问")]),a._v(" "),s("h3",{attrs:{id:"agent部署"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#agent部署"}},[a._v("#")]),a._v(" agent部署")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("cd /data \ncp -r apache-skywalking-apm-bin/agent /你的项目目录/dockerfile所在目录\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("#编辑dockerfile将以下参数加入dockerfile\nRUN mkdir /root/agent\nCOPY ./agent /root/agent\n")])])]),s("p",[a._v("#修改java应用启动参数")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("java -javaagent:/root/agent/skywalking-agent.jar=agent.service_name=group_module -Dskywalking.collector.backend_service=172.62.0.52:11800 -jar /root/group-module-1.0-SNAPSHOT.jar --server.port=8890\n")])])]),s("h3",{attrs:{id:"至此客户端和服务端部署完成-可以打开ui界面进行访问"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#至此客户端和服务端部署完成-可以打开ui界面进行访问"}},[a._v("#")]),a._v(" 至此客户端和服务端部署完成，可以打开ui界面进行访问")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://img-blog.csdnimg.cn/76cc94b9b0274afeb13a219437960dc2.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}}),a._v(" "),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/26617f7d2d4745fa80b30c1f2998cac4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}}),a._v(" "),s("img",{attrs:{src:"https://img-blog.csdnimg.cn/dcdea26933ac4ac39dde415c5f5ae9f4.png?x-oss-process=image/watermark,type_d3F5LXplbmhlaQ,shadow_50,text_Q1NETiBAQWxleENsb3duZmlzaA==,size_20,color_FFFFFF,t_70,g_se,x_16",alt:"在这里插入图片描述"}})])])}),[],!1,null,null,null);e.default=r.exports}}]);